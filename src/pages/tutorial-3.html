---
layout: index
meta-title: "MidicaPL Tutorial 3: Structures - MIDI Programming Language for Midica"
---

<div class="grid-container midicapl">
	<div class="grid-x grid-padding-x">
		<h1 class="cell">MidicaPL Tutorial, Chapter 3: Structures</h1>
	</div>
	<section class="grid-x grid-padding-x" id="intro">
		<div class="cell">
			<p>
				This is the third chapter of the MidicaPL tutorial. Please read <a href="tutorial-1.html">chapter 1</a> and
				<a href="tutorial-2.html">chapter 2</a> first, if you have not yet done that already.
			</p>
			<p>
				So far you learned a lot about lowlevel commands. In this chapter we will focus on highlevel structures that help to reuse your code,
				like macros, blocks and loops.
			</p>
		</div>
	</section>
	<section class="grid-x grid-padding-x" id="macros">
		<div class="cell">
			<h2>Macros</h2>
		</div>
		<div class="cell">
			<p>
				Most programming languages have functions, methods or another kind of subroutines that can be called from different places
				inside of your source code. In MidicaPL such functions are called <em>macro</em>.
			</p>
			<p>
				A macro is a bock beginning with the keyword <code>MACRO</code>, followed by one or more whitespaces and a self-given macro name.
				The block is closed with the keyword <code>END</code>.
				Inside the block you can write as many channel commands or global commans as you want.
			</p>
			<p>
				The following example defines two macros for "Another one bites the dust" by "Queen".
			</p>
		</div>
		<div class="cell medium-shrink">{{> src-example src-examples.another-one-drum-bass }}</div>
		<div class="cell medium-auto">
			<p>
				First we introduce the bass instrument in channel 5 so that we can use it later. Then we define the macros.
			</p>
			<p>
				The first macro is called <code>bassline</code>. It defines the main bassline and has a length of 8 quarter notes.
			</p>
			<p>
				The second macro is called <code>drums</code>. It defines the drum beat with a length of 2 quarter notes.
			</p>
			<p>
				So far no sound is produced at all. The macros have been defined but they have not yet been called.
			</p>
			<p>
				Later we want to play the bass and the drums together. The <code>bassline</code> macro is 4 times longer
				than the <code>drums</code> macro.
				That means we need to call <code>drums</code> 4 times more often than <code>bassline</code>.
			</p>
		</div>
		<div class="cell">
			<p>
				A macro can be called with the <code>INCLUDE</code> command, followed by one or more whitespaces and the macro name.
			</p>
			<p>
				You can imagine that an <code>INCLUDE</code> command is internally replaced by the code inside of the macro.
			</p>
			<p>
				The following example plays the macros that we have defined before. The first source code version uses <code>INCLUDE</code> commands.
				The second version shows how these INCLUDEs would look like if they were replaced by the according macro contents.
			</p>
		</div>
		<div class="cell">{{> src-example src-examples.another-one }}</div>
		<div class="cell">
			<p>
				Both macros play in different channels. So if we include them after each other they play simultaneously.
			</p>
		</div>
		<div class="cell">
			<p>
				A macro can also be called from another macro.
				So an alternative for the last example would be the usage of a further macro:
			</p>
		</div>
		<div class="cell medium-shrink">{{> src-example src-examples.another-one-2 }}</div>
		<div class="cell medium-auto">
			<p>
				Now we need to handle the different lengths of tha bass and drum macros only at one place: inside the macro <code>drum-and-bass</code>.
				Later we can call this macro as often as we want.
			</p>
		</div>
		<div class="cell">
			<p>
				In the last example we defined the macro first and included it later. But the other way round is also possible.
			</p>
		</div>
		<div class="cell medium-shrink">{{> src-example src-examples.another-one-3 }}</div>
		<div class="cell medium-auto">
			<p>
				In this example the macro is included before it is defined.
			</p>
		</div>
	</section>
	<section class="grid-x grid-padding-x" id="include-options">
		<div class="cell">
			<h2>Include Options</h2>
		</div>
		<div class="cell medium-6">
			<p>
				Do you remember the <a href="tutorial-2.html#channel-options">channel command options</a> from chapter 2?
			</p>
			<p>
				An <code>INCLUDE</code> command can also have options.
				As you can see in the <em>Include Options</em> table, <code>quantity</code> (short version: <code>q</code>) and
				<code>multiple</code> (short version: <code>m</code>) are also allowed as include options.
			</p>
		</div>
		<div class="cell medium-6">
			<table>
				<caption>
					Include Options
				</caption>
				<thead>
					<tr>
						<th>Long Name</th>
						<th>Short Name</th>
						<th>Type</th>
						<th>Min Value</th>
						<th>Max Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>quantity</td>
						<td>q</td>
						<td>integer</td>
						<td>1</td>
						<td>&infin;</td>
					</tr>
					<tr>
						<td>multiple</td>
						<td>m</td>
						<td>none</td>
						<td>-</td>
						<td>-</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="cell">
			<p>
				Include options are attached to the end of the <code>INCLUDE</code> command line, separated from the macro name by one or more whitespaces.
			</p>
			<p>
				If an option requires a value, this must be appended to the option name, separated by a <code>=</code> symbol or whitespace(s).
			</p>
				If 2 options are used, they have to be separated by a <code>,</code> symbol.
			</p>
		</div>
		<div class="cell">
			<h3>Quantity (Include Option)</h3>
		</div>
		<div class="cell">
			<p>
				Probably you already have guessed what the <code>quantity</code> option does: It repeats the called macro as often as the option value.
				So we can rewrite our includes using the quantity option. The following versions are all equivalent:
			</p>
		</div>
		<div class="cell">{{> src-example src-examples.another-one-q }}</div>
		<div class="cell">
			<h3>Multiple (Include Option)</h3>
		</div>
		<div class="cell">
			<p>
				The <code>multiple</code> option can be used to implement different voices playing in the same channel in the same time.
				It plays the macro and then moves the end markers of each involved channel to the position they had before calling the macro.
			</p>
			<p>
				In other words: After playing a macro with this option, the next notes in the same channels are played in the same time as the macro.
			</p>
			<p>
				The next example shows how we can use this option in order to play a small variation.
			</p>
		</div>
		<div class="cell">{{> src-example src-examples.another-one-complete }}</div>
		<div class="cell">
			<p>
				The red part is the anacrusis (upbeat) without drums. The sync command (<code>*</code>) synchronizes
				the involved channels so that the drums start after the anacrusis.
			</p>
			<p>
				The blue part adds two bass notes to the end of the second measure. Therefore the first <code>INCLUDE</code> command
				is marked as <code>multiple</code> so that the following code is added to the time where the include started.
			</p>
			<p>
				As we want to add something to the last eighth of the measure, we need to fill up the beginning with rests in the bass channel.
				We need a whole rest with three dots.
			</p>
			<p>
				After adding the rest and the notes, our bass channel is two beats further than our drums channel. So we need to synchronize them
				again with another <code>*</code>.
			</p>
			<p>
				Then we are ready to include <code>drum-and-bass</code> again a few times.
			</p>
		</div>
	</section>
	<section class="grid-x grid-padding-x" id="nestable-blocks">
		<div class="cell">
			<h2>Nestable Blocks</h2>
		</div>
		<div class="cell">
			<p>
				Macros are useful to group a number of commands and apply them later using a self-invented name.
				But sometimes you may want to group commands without inventing a name and execute them directly instead of calling them later.
				That's where nestable blocks are used.
			</p>
			<p>
				Programming languages also have nestable blocks like <em>if</em> or <em>else</em> blocks or loops.
				In MidicaPL such a block is opened by a line beginning with <code>(</code> and closed by a line beginning with <code>)</code>.
			</p>
			<p>
				So let's try to rewrite the drums and bass of the above song using nestable blocks:
			</p>
		</div>
		<div class="cell">{{> src-example src-examples.another-block }}</div>
		<div class="cell">
			<p>
				We formed a block for the bass part and a second one for the drums part. Both blocks are nested inside of another block.
				The commands are played directly without the need of an include.
			</p>
			<p>
				But hey... The Bass part is played only once!
				One quick and dirty way to fix this problem is to use the <code>drums</code> macro we have defined before:
			</p>
		</div>
		<div class="cell">{{> src-example src-examples.another-block-2 }}</div>
		<div class="cell">
			<p>
				So you see, an <code>INCLUDE</code> can be used from inside a block as well.
			</p>
			<p>
				On the other hand you can also use blocks inside of a <code>MACRO</code>.
				Let's rewrite the macro <code>drum-and-bass</code> using blocks:
			</p>
		</div>
		<div class="cell">{{> src-example src-examples.another-block-3 }}</div>
		<div class="cell">
			<p>
				Those examples are equivalent. One version uses blocks, the other one doesn't.
			</p>
			<p>
				The version with blocks doesn't need a macro for the bass part. However the drums part is needed in both versions.
				And of cause we could have written the same thing completely without blocks. This was just a demonstration that
				blocks can be nested inside of macros.
			</p>
			<p>
				Blocks become much more useful when using block options.
			</p>
		</div>
	</section>
	<section class="grid-x grid-padding-x" id="block-options">
		<div class="cell">
			<h2>Block Options</h2>
		</div>
		<div class="cell medium-6">
			<p>
				Just like <code>INCLUDE</code> commands, nestable blocks can have options as well. The <em>block options</em> table shows the available options.
				As you can see, the options <code>quantity</code> (short version: <code>q</code>) and <code>multiple</code> (short version: <code>m</code>)
				are also available as block options. Moreover there's a new option for tuplets.
			</p>
			<p>
				Options can be attached to the opening <code>(</code> or closing <code>)</code> brace, separated by whitespaces.
			</p>
		</div>
		<div class="cell medium-6">
			<table>
				<caption>
					Block Options
				</caption>
				<thead>
					<tr>
						<th>Long Name</th>
						<th>Short Name</th>
						<th>Type</th>
						<th>Min Value</th>
						<th>Max Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>quantity</td>
						<td>q</td>
						<td>integer</td>
						<td>1</td>
						<td>&infin;</td>
					</tr>
					<tr>
						<td>multiple</td>
						<td>m</td>
						<td>none</td>
						<td>-</td>
						<td>-</td>
					</tr>
					<tr>
						<td>tuplet</td>
						<td>t</td>
						<td>none or string</td>
						<td>-</td>
						<td>-</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="cell">
			<p>
				If you want (or must) pass a value to an option, the value must be appended to the option name, separated by a <code>=</code> symbol or whitespace(s).
			</p>
				If more than one option is used, they have to be separated by a <code>,</code> symbol.
			</p>
		</div>
		<div class="cell">
			<h3>Quantity (Block Option)</h3>
		</div>
		<div class="cell">
			<p>
				The <code>quantity</code> option plays the according block as many times as its value defines.
				Eventually we are able to rewrite the macro <code>drum-and-bass</code> correctly and without needing to define the macros <code>drums</code>
				and <code>bassline</code>:
			</p>
		</div>
		<div class="cell">{{> src-example src-examples.another-block-4 }}</div>
		<div class="cell">
			<h3>Multiple (Block Option)</h3>
		</div>
		<div class="cell">
			<p>
			</p>
		</div>
		<div class="cell">
			<h3>Tuplet (Block Option)</h3>
		</div>
		<div class="cell">
			<p>
			</p>
		</div>
	</section>
	<aside>
		You are now ready for <a href="tutorial-4.html">chapter 4</a> to dive more into the details.
	</aside>
</div>
